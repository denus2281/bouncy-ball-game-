
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>3D Попрыгунчик</title>
<style>
  body { margin:0; overflow:hidden; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
let scene, camera, renderer, cube, platforms=[], clock, score=0, gameOver=false, velocity={x:0,y:0,z:0};
init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.fog = new THREE.Fog(0x000000, 10, 50);
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,5,10);
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);
  window.addEventListener('resize', ()=> {
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });
  
  // Пол
  const floorGeo = new THREE.PlaneGeometry(20,20);
  const floorMat = new THREE.MeshStandardMaterial({color:0x222222});
  const floor = new THREE.Mesh(floorGeo,floorMat);
  floor.rotation.x=-Math.PI/2;
  scene.add(floor);
  
  // Попрыгунчик
  const cubeGeo = new THREE.BoxGeometry(1,1,1);
  const cubeMat = new THREE.MeshStandardMaterial({color:0x00ffff});
  cube = new THREE.Mesh(cubeGeo,cubeMat);
  cube.position.y=1;
  scene.add(cube);
  
  // Свет
  const ambientLight = new THREE.AmbientLight(0xffffff,0.5);
  scene.add(ambientLight);
  const dirLight = new THREE.DirectionalLight(0xffffff,1);
  dirLight.position.set(5,10,7.5);
  scene.add(dirLight);
  
  // Платформы
  for(let i=0;i<5;i++){
    createPlatform(-i*4);
  }
  clock = new THREE.Clock();
  document.addEventListener('keydown', onKeyDown);
  document.addEventListener('keyup', onKeyUp);
}

function createPlatform(y) {
  const geo = new THREE.BoxGeometry(3,0.2,3);
  const mat = new THREE.MeshStandardMaterial({color:0xff00ff});
  const platform=new THREE.Mesh(geo,mat);
  platform.position.set((Math.random()-0.5)*8, y, (Math.random()-0.5)*8);
  scene.add(platform);
  platforms.push(platform);
}

let keys={};
function onKeyDown(e){ keys[e.key]='pressed'; }
function onKeyUp(e){ keys[e.key]=false; }

function animate() {
  requestAnimationFrame(animate);
  const delta=clock.getDelta();

  if(!gameOver){
    // управление
    if(keys['ArrowLeft']) cube.position.x-=5*delta;
    if(keys['ArrowRight']) cube.position.x+=5*delta;
    if(keys[' '] && cube.position.y<=1.01){ velocity.y=8; }

    // гравитация
    velocity.y -= 9.8 * delta;
    cube.position.y += velocity.y * delta;

    // приземление
    if(cube.position.y<=1){
      cube.position.y=1;
      velocity.y=0;
    }

    // проверка на платформы
    for(let p of platforms){
      if(Math.abs(cube.position.x - p.position.x)<1.5 &&
         Math.abs(cube.position.z - p.position.z)<1.5 &&
         Math.abs(cube.position.y - p.position.y -0.1)<0.5 &&
         velocity.y<=0){
        cube.position.y=p.position.y+0.1;
        velocity.y=0;
      }
    }

    // движение платформ
    for(let p of platforms){ p.position.y+=-2*delta; }
    if(platforms[0].position.y<-5){ scene.remove(platforms.shift()); createPlatform(10); score++; document.title='Очки: '+score; }

    // камера
    camera.position.x=cube.position.x*0.8;
    camera.position.z=cube.position.z+10;
    camera.lookAt(cube.position);

    // конец
    if(cube.position.y<-5) { gameOver=true; }
  }

  renderer.render(scene, camera);
}
</script>
</body>
</html>
